<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <title>Exercise</title>
    <style>
        text {
            alignment-baseline: hanging;
            font-family: sans-serif;
            font-size: 10px;
        }
        text.month {
            text-anchor: middle;
        }
    </style>
</head>
<body>
<script>
    const file = '../data/temperatures.csv';
    const h = 200, w = 800;

    const svg = d3.select("body")
        .append("svg")
        .attr("height", h)
        .attr("width", w);

    // 1) define a color scale here
    const color = d3.scaleDiverging(d3.interpolateRdYlBu);

    d3.csv(file, d3.autoType).then(data => {
        const months = data.columns.filter(d => d != 'city');
        const dataset = data.map(c => ({city: c.city,values: months.map(k => c[k])}));
        const values = d3.merge(dataset.map(d => d.values));

        // 2) set the domain for the color scale
        color.domain([d3.max(values),0,d3.min(values)])

        display(dataset);
    });

    function display(data) {
        svg.selectAll("g")
           .data(data)
             .join("g")
               .attr("class", "city")
               .each(function(d,i) {
                   const city = d3.select(this);

                   city.append("text")
                       .attr("class", "city")
                       .text(d.city)
                       .attr("y", i*20 + 20);

                   // 3. use the color scale to fill the rectangles
                   city.selectAll("rect.month")
                       .data(d.values)
                       .join("rect")
                       .attr("class", "month")
                       .attr("y", i*20 + 20)
                       .attr("x", (_,j) => j*45 + 100)
                       .attr("height", 20)
                       .attr("width", 40)
                       .attr("fill", color); // 3

                   // 4. use the color scale to add a contrasting text value over the rectangle
                   city.selectAll("text.month")
                       .data(d.values)
                       .join("text")
                       .attr("class", "month")
                       .attr("y", i*20 + 25)
                       .attr("x", (_,j) => j*45 + 20 + 100)
                       .attr("fill", c => d3.hsl(color(c)).l > .5 ? 'black' : 'white') // 4
                       .text(m => m);
               })
    }

</script>
</body>
</html>