<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stack order - Bars</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        text {
            font-family: monospace;
            font-size: 14px;
        }
        svg {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
<script>

    const dim = {
        width: 1000,
        height: 600,
        margin: {top: 20, right: 300, bottom: 20, left: 20}
    };

    const svg = d3.select("body")
        .append("svg")
        .attr("height", dim.height)
        .attr("width", dim.width);

    const stackOrder = [
        'stackOrderNone',
        'stackOrderAscending',
        'stackOrderDescending',
        'stackOrderInsideOut',
        'stackOrderReverse',
        'stackOrderAppearance'
    ];

    const populations = [
        {year: 1960, "A": 38174, "B": 17917, "C": 186808},
        {year: 1980, "A": 69361, "B": 24537, "C": 229763},
        {year: 2000, "A": 101720, "B": 30736, "C": 281983}
    ];

    const scale = d3.scaleLinear()
        .range([dim.margin.left, dim.width - dim.margin.right]);
    const stack = d3.stack()
        .keys(['A', 'B', 'C']);


    const colorScale = d3.scaleOrdinal(d3.schemeObservable10)
            .domain([0,populations.length]);

    stackOrder.forEach((d,i) => draw(d, i));

    function draw(order, index) {
        stack.order(d3[order]);

        const stacked = stack(populations);

        scale.domain([0, d3.max(d3.merge(d3.merge(stacked)))]);

        // A group for each set of stacked bars
        const g = svg.append("g")
            .attr("transform", `translate(${[0, 100*index + 18]})`);


        g.selectAll(".year")
            .data(stacked)
            .join("g").attr("class", "year")
            .style("fill", (d,i) => colorScale(i))
            .each(function(d) {
                d3.select(this)
                    .selectAll(".country")
                    .data(d => d)
                    .join("rect").attr("class", "country")
                    .attr('width', d => scale(d[1]) - scale(d[0]))
                    .attr('height', 20)
                    .attr('x', d => scale(d[0]))
                    .attr('y', (d,i) => i * 22);
            });

        g.append("text")
            .text(`d3.${order}`)
            .attr("x", dim.width - dim.margin.right + 20)
            .attr("y", 35)
    }


</script>
</body>
</html>